---
title: "Spotify Exploration"
author: "Julia Koh, Dana Korssjoen, Heeju Son, and Allison Wick"
output: html_document
---

```{r setup, warning = FALSE, include = FALSE, message = FALSE, echo = FALSE}
knitr::opts_chunk$set(echo = TRUE)
library("dplyr")
library("ggplot2")
library("spotifyr")
library("knitr")
library("plotly")

# The Song Features Dataset
songs_df <- read.csv("data/SpotifyFeatures.csv", stringsAsFactors = FALSE ) %>%
  # Filter genres that either do not have enough observations or we deemed
  # as irrelevant genres
  filter(genre != "A Capella" & genre != "Comedy" &
         genre != "Movie" & genre != "Soundtrack")
# The Top 50 by Country Dataset
country_data <- read.csv(file = "./data/country_data.csv", stringsAsFactors = F)

# Source files
source("scripts/table.R")
source("scripts/summary_info.R")
source("scripts/bar_chart.R")
source("scripts/histogram.R")
#source("scripts/country_map.R")
```

## Introduction
Our problem domain analyzes audio features and music genres and answers the questions: 

- How do audio features vary across genres?
- How do audio features vary across popular songs in different countries?

The purpose of the project is to explore the differences of audio features between genres and across different countries. Using data from the audio streaming platform, Spotify, we have created a bar chart, histogram, and map of how these differences can be visualized. The source of our data comes from the `spotifyr` package.

## Summary

```{r summary_info, warning = FALSE, include = FALSE, message = FALSE, echo = FALSE}
length <- get_summary_info(songs_df)$length
num_obs <- get_summary_info(songs_df)$num_obs
col_names <- get_summary_info(songs_df)$col_names
genre_types <- get_summary_info(songs_df)$genres
num_of_genres <- length(get_summary_info(songs_df)$genres)
num_of_each_genre <- get_summary_info(songs_df)$num_of_each_genre
```
The dataset has `r num_obs` observations and `r length` variables. These variables are the columns of the datasets, and the column names are `r col_names`.
This particlar project is interested in understanding the variance of 
different audio features across genres. Therefore, the different genres observed in
the dataset are `r genre_types`. Lastly, it is important to note that while the number of observations for the genres are similar, they are not equal. This is expressed in the table below. 

```{r summary_table2, warning = FALSE, message = FALSE, echo = FALSE}
kable(num_of_each_genre)
```

## Table

The following table shows the average danceability, energy, valence, acousticness, and tempo based on **music genre**. The table is ordered by which genre has the highest average _popularity ratings_ on a scale from 0-100. `r popular` music is highest on the charts. `r tempo` music has the fastest average tempo. `r valence` music has the highest average valence. `r energy` music has the highest average energy. `r acoustic` music is the most acoustic on average. `r dance` music has the highest average danceability.

Interestingly, the table shows trends across genres such as when popularity of a genre decreases acousticness tends to increase. For example, opera and classical music are two of the least popular genres and have average acousticness of `r opera_acoustic` and `r classical_acoustic`, respectively. In addition, reggaeton and reggae are not popular genres yet have the highest levels of danceability at `r reggaeton_dance` and `r reggae_dance`, respectively.

```{r summary_table, warning = FALSE, message = FALSE, echo = FALSE}
summary_table <- get_table_info(songs_df)
kable(summary_table)
```

## Charts
### Bar Chart 
The bar chart below attempts to express how the audio features of the chosen
genres (designated in the summary information) vary from one another. In order to achieve this, the chart examines the audio feature of valence for  comparison across the genres was valence. The average valence was taken for each genre (i.e.
the average valence of 100 songs for each genre), and is displayed from greatest 
to least in the bar chart. Our intent for the final project is to be able to change
the audio feature, from valence to another choice, based off user input.

Please note: Valence as described by the Spotify API is the postiveness of the song (0 - extremely negative; 1 - highly positive).

```{r chart_one,warning = FALSE, message = FALSE, echo = FALSE}
genre_bar_chart
```

The information from the chart reveals that music categorized as "regge" has the highest valence and "opera" music has the lowest valence. As we look at the ordering of the valence scores, the placement of some genres is not completely surprising as our team can imagine the cultural characteristics associated with each genre. For example, operatic themes trend towards dishonor and suicide, unrequited love, death and pain, all accounting for the genre's low valence score. On the other hand, the chart reveals surprising findings such as how reggae has the highest valence score. This is strange since reggae music boasts musical themes such as social criticism and diaspora feelings, which are arguably negative topics. However, this leads us into further investigation, as the Spotify API does not state how valence is measured it is possible that factors other than lyrics contribute to the score. Therefore, we hope to examine how other features like speechiness, tempo, danceability, etc. contribute to valence, as well as examine how audio features vary across genres.  


### Histogram
- How do audio features vary across genres?
- How do audio features vary across popular songs in different countries?

The histogram attempts to show what range a single feature of one genre is in. From this, we can learn the general trend of even the mean value of danceability feature in genre of opera. This is important to know since we can better understand the structure and trend of audio features across every genres only if we fully understand how a specific feature looks like in each genre.

```{r chart_two, warning = FALSE, message = FALSE, echo = FALSE}
histogram_opera
```

As you can see in the histogram chart, most of the danceability of opera goes within the range of 0.2-0.3. Also, since it is a slightly right-skewed histogram, we can also learn that the mean is greater than the median of daceability in opera.

### Map

The map attempts to visualize how the average valence of top 50 songs vary by country. In other words, how positive does each country in North America prefer their music? As you can see in the map, Central American countries prefer their music to be highly positive, while valence gets lower (i.e. music gets less positive) as you go futher North. For the final project, we intend to add more countries to this chart and allow the characteristic that is visualized (in this case, valence) to be selected by the user from a list of musical characteristics.

The chart is interactive; you can hover over each country to see its precise average valence score.

```{r chart_three, warning = FALSE, message = FALSE, echo = FALSE}
#country_map
```
